<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tutor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        input, button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }
        #response {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>AI Tutor</h2>
    <input type="text" id="question" placeholder="Enter your question here">
    <button onclick="askAI()">Ask</button>

    <p id="response">Response will appear here...</p>

    <script>
        const LOGIC_APP_URL = "https://prod-30.southindia.logic.azure.com:443/workflows/f6ad47edbaaf42b0a3b6e4816d8fbb73/triggers/When_a_HTTP_request_is_received/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2FWhen_a_HTTP_request_is_received%2Frun&sv=1.0&sig=c8sFzIKpt9E-VoiCZ46VuTosaiSZjQL0JkzmrxUWkV0"; // Replace with your actual Logic App URL

        async function askAI() {
            const question = document.getElementById("question").value;
            if (!question) {
                alert("Please enter a question.");
                return;
            }

            document.getElementById("response").innerText = "Processing...";

            try {
                // Step 1: Send the question to the Logic App
                let initResponse = await fetch(LOGIC_APP_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question })
                });

                let initData = await initResponse.json();
                console.log("Initial Response:", initData);

                if (!initData || !initData.id) {
                    throw new Error("Invalid initial response from Logic App.");
                }

                // Step 2: Poll for the response
                let runId = initData.id;
                let result;
                for (let i = 0; i < 10; i++) {  // Poll up to 10 times
                    await new Promise(res => setTimeout(res, 3000)); // Wait for 3 seconds

                    let statusResponse = await fetch(`${LOGIC_APP_URL}/runs/${runId}`);
                    let statusData = await statusResponse.json();
                    console.log("Polling Response:", statusData);

                    if (statusData.properties.status === "Succeeded") {
                        result = statusData.properties.outputs.body;
                        break;
                    }
                }

                if (!result || !result.answer) {
                    throw new Error("No valid response received from AI.");
                }

                // Display the answer
                document.getElementById("response").innerText = `Answer: ${result.answer}`;

            } catch (error) {
                console.error("Error:", error);
                document.getElementById("response").innerText = "‚ùå Error connecting to AI Tutor.";
            }
        }
    </script>

</body>
</html>
