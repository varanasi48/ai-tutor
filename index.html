<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tutor</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; padding: 20px; background: #f4f4f9; }
        h1 { color: #333; }
        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }
        input, button {
            width: 80%;
            padding: 10px;
            margin: 10px 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #45a049; }
        #response { margin-top: 20px; font-size: 18px; min-height: 50px; text-align: left; }
        .image-container img { max-width: 100%; border-radius: 8px; margin-top: 10px; }
        video { width: 100%; margin-top: 10px; border-radius: 8px; }
        canvas { width: 100%; height: 200px; border: 1px solid #000; margin-top: 20px; }
    </style>
</head>
<body>

    <h1>AI Tutor</h1>
    <div class="container">
        <input type="text" id="question" placeholder="Enter your question">
        <button onclick="fetchLecture()">Ask AI</button>
        <div id="response">Waiting for response...</div>
        <canvas id="scrollingText"></canvas>
    </div>

    <script>
        async function fetchLecture() {
            const question = document.getElementById("question").value;
            if (!question) {
                alert("Please enter a question");
                return;
            }

            const LOGIC_APP_URL = "https://prod-30.southindia.logic.azure.com:443/workflows/f6ad47edbaaf42b0a3b6e4816d8fbb73/triggers/When_a_HTTP_request_is_received/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2FWhen_a_HTTP_request_is_received%2Frun&sv=1.0&sig=c8sFzIKpt9E-VoiCZ46VuTosaiSZjQL0JkzmrxUWkV0";

            document.getElementById("response").innerText = "⏳ Processing...";

            try {
                const response = await fetch(LOGIC_APP_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question })
                });

                if (response.status === 202) {
                    document.getElementById("response").innerText = "⏳ AI is thinking...";
                    const location = response.headers.get("Location");
                    if (location) {
                        checkStatus(location);
                    } else {
                        document.getElementById("response").innerText = "❌ No result URL provided.";
                    }
                } else if (response.status === 200) {
                    const result = await response.json();
                    displayLecture(result);
                } else {
                    document.getElementById("response").innerText = "❌ Error connecting to AI Tutor.";
                }
            } catch (error) {
                console.error("Fetch error:", error);
                document.getElementById("response").innerText = "❌ Request failed.";
            }
        }

        async function checkStatus(url) {
            try {
                const response = await fetch(url);
                if (response.status === 200) {
                    const result = await response.json();
                    console.log("Full Response:", result);
                    displayLecture(result);
                } else {
                    setTimeout(() => checkStatus(url), 3000);
                }
            } catch (error) {
                console.error("Polling error:", error);
                setTimeout(() => checkStatus(url), 3000);
            }
        }

        function displayLecture(result) {
            const responseContainer = document.getElementById("response");
            responseContainer.innerHTML = "";  // Clear previous response

            // Display the main lecture text
            const lectureText = document.createElement("p");
            lectureText.textContent = result?.answer || "No lecture content available.";
            responseContainer.appendChild(lectureText);

            // Display images if available
            if (result?.images?.length) {
                result.images.forEach(imgUrl => {
                    const img = document.createElement("img");
                    img.src = imgUrl;
                    img.alt = "Lecture Image";
                    img.className = "image-container";
                    responseContainer.appendChild(img);
                });
            }

            // Display videos if available
            if (result?.videos?.length) {
                result.videos.forEach(videoUrl => {
                    const video = document.createElement("video");
                    video.setAttribute("controls", "");
                    const source = document.createElement("source");
                    source.src = videoUrl;
                    source.type = "video/mp4";
                    video.appendChild(source);
                    responseContainer.appendChild(video);
                });
            }

            // Start scrolling text effect
            startScrollingText(result?.answer || "No lecture text available.");
        }

        function startScrollingText(text) {
            const canvas = document.getElementById("scrollingText");
            const ctx = canvas.getContext("2d");
            let y = canvas.height;

            ctx.font = "18px Arial";
            ctx.fillStyle = "black";

            function scroll() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillText(text, 10, y);
                y -= 1; // Adjust speed of scrolling

                if (y > -30) {
                    requestAnimationFrame(scroll);
                }
            }

            scroll();
        }
    </script>

</body>
</html>
